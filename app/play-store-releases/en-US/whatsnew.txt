Code/UI improvements and fixes.